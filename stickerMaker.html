<!DOCTYPE html>
<html>
	<title>文字表情制作器</title>

	<meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport">
	<link rel="stylesheet" type="text/css" href="weui2.css">

	<script type="text/javascript">

	//在画布上绘制背景图片
	var c2=document.getElementById("stickerWord");
	var cxt2=c2.getContext("2d");
	var img2 = new Image();
	img2.src="images/stickerBg.png";
	cxt2.drawImage(img2,0,0);

	//获取画布
    function getCanvas(id) {
        return document.getElementById(id);
    }
    
	//在画布上写文字
    function writeText() {
        var theText = document.getElementById("inputBox").value;
        var theCanvas = getCanvas('stickerWord');
        var textBlock = theCanvas.getContext('2d');
        
		//计算文字长度，改变画布宽度
        theCanvas.width = 60*theText.length
        
        textBlock.font = 'bold 100px Yuanti SC';
        textBlock.fillStyle = '#000000';
        textBlock.fillText(theText, 0, 130);
    }

	//清空画布
    function clearCanvas () {
    	var theCanvas = getCanvas('stickerWord');
    	var textBlock = theCanvas.getContext('2d');
    	textBlock.clearRect(0, 10, theCanvas.width, 160);
    }

    //画布转图片base64编码
    function convertCanvasToImage(canvas) {
		var image = new Image();
		image.src = canvas.toDataURL("image/png");
		return image;
	}
	
	//生成图片，插入节点
	function generateImg () {
			
			clearCanvas();
	 		
	 		writeText(); 

	 		var imgCanvas = convertCanvasToImage(stickerWord);

			var stickerImageBlock = document.getElementById('stickerImageBlock');

			var stickerImageBlockImg = document.createElement('img');

			stickerImageBlockImg.src = imgCanvas.src;

			var existedSticker=document.getElementById("stickerImageBlock")
			
			existedSticker.insertBefore(stickerImageBlockImg,existedSticker.childNodes[2]);

			var useInstruction = document.getElementById("useInstruction");
			
			useInstruction.style.display = "inline";

	}

	</script>

	<body>
		
		<div align="center" id="container">
				<canvas id="stickerWord" width="640" height="180" ></canvas>
		</div>

	</br>

		<div id="stickerPreview">
			
			<div id="inputBoxC">
				<input class="input" type="text" id="inputBox" placeholder="请输入文字" value = "呵。">				
			</div>

		</div>

	</br>

		<div align = "center" id="btn" onclick="generateImg();" class="weui-btn weui-btn_default">
			生成贴纸
		</div>
	
	</br>

		<div align = "center" id="stickerImageBlock">
			<p style="display: none" id="useInstruction">
				长按下面图片保存到手机，再添加到微信自定义表情
			</p>
			<img src="" id="0">
		</div>

	</body>

</html>